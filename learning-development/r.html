<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>R – Analysts’ Guide</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../learning-development/git.html" rel="next">
<link href="../learning-development/sql.html" rel="prev">
<script src="../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-KBJCBD114T"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-KBJCBD114T', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"headline",
  "consent_type":"implied",
  "palette":"dark",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../learning-development/learning-support.html">Learning resources</a></li><li class="breadcrumb-item"><a href="../learning-development/r.html">R</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/duck_guidance.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="mailto:statistics.development@education.gov.uk" title="Email us" class="quarto-navigation-tool px-1" aria-label="Email us"><i class="bi bi-envelope"></i></a>
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-microsoft-teams"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://teams.microsoft.com/l/team/19%3a50f82a2718184a0e98ba86c3d411a02f%40thread.skype/conversations?groupId=6572094f-43a3-4537-bcf0-fc27dc6557ed&amp;tenantId=fad277c9-c60a-4da1-b5f3-b3b8b34a82f9" target="_blank">
            DfE analysts network
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://teams.microsoft.com/l/team/19%3ae3c8551e86094e259a60848fcff4dbc1%40thread.skype/conversations?groupId=679b2376-8c8c-4062-a1c9-0744ce5ac88f&amp;tenantId=fad277c9-c60a-4da1-b5f3-b3b8b34a82f9" target="_blank">
            Statistics production
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://teams.microsoft.com/l/team/19%3a311ec2e4d46b4dd38f0d61f05fb93383%40thread.skype/conversations?groupId=b95c605d-8fbc-4e4d-9a76-2f7d1c55e70a&amp;tenantId=fad277c9-c60a-4da1-b5f3-b3b8b34a82f9" target="_blank">
            DfE R community
            </a>
          </li>
      </ul>
    </div>
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-1" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-camera-reels"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-1">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://educationgovuk.sharepoint.com/:f:/r/sites/lvewp00086/SSU%20%20open%20sharing/Statistician%27s%20Guide%20to%20the%20Galaxy?csf=1&amp;web=1&amp;e=owScaj" target="_blank">
            Guide to the Galaxy sessions
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://educationgovuk.sharepoint.com/:f:/r/sites/lvewp00086/SSU%20%20open%20sharing/Explore%20Education%20Statistics?csf=1&amp;web=1&amp;e=HVpi0D" target="_blank">
            EES show and tells
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://educationgovuk.sharepoint.com/:f:/r/sites/lvewp00086/SSU%20%20open%20sharing/Reproducible%20Analytical%20Pipeline%20(RAP)%20resources/Knowledge-share%20series?csf=1&amp;web=1&amp;e=H0pcSH" target="_blank">
            RAP knowledge share series
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://educationgovuk.sharepoint.com/sites/sarpi/g/AC/Coffee%20and%20Coding.aspx?xsdata=MDV8MDF8fGU5YTkwYWU1OTNiNjQzZTIyZTM2MDhkYjVhY2MxN2JlfGZhZDI3N2M5YzYwYTRkYTFiNWYzYjNiOGIzNGE4MmY5fDB8MHw2MzgyMDM2MDQ4MjEyMjUwMTR8VW5rbm93bnxWR1ZoYlhOVFpXTjFjbWwwZVZObGNuWnBZMlY4ZXlKV0lqb2lNQzR3TGpBd01EQWlMQ0pRSWpvaVYybHVNeklpTENKQlRpSTZJazkwYUdWeUlpd2lWMVFpT2pFeGZRPT18MXxMMk5vWVhSekx6RTVPbTFsWlhScGJtZGZXVlJuZUUxRVVUTlphbGwwVGpKUk1FNTVNREJhYW1zMVRGUnJNbHBYV1hSTmVtTjZXbXBCTWxwdFZUQlBWMVV3UUhSb2NtVmhaQzUyTWk5dFpYTnpZV2RsY3k4eE5qZzBOell6TmpneE5qRXh8YjdlZWE0MGYzNDg5NGYxYzJlMzYwOGRiNWFjYzE3YmV8MmE3NzU1YzRmOWMyNDZlOTkwYWVmMjlkZjY5NjczZWE%3D&amp;sdata=ajlKYUZuNHFyNU9XSm5WR3ZZaUZHZDB4bjVJYkJzRFZNc0U1Uit5V1Q5cz0%3D&amp;ovuser=fad277c9%2Dc60a%2D4da1%2Db5f3%2Db3b8b34a82f9%2CTess%2EWILLIAMS%40EDUCATION%2EGOV%2EUK&amp;OR=Teams%2DHL&amp;CT=1684763684990&amp;clickparams=eyJBcHBOYW1lIjoiVGVhbXMtRGVza3RvcCIsIkFwcFZlcnNpb24iOiIyNy8yMzA0MDIwMjcwNSIsIkhhc0ZlZGVyYXRlZFVzZXIiOmZhbHNlfQ%3D%3D" target="_blank">
            Coffee and coding sessions
            </a>
          </li>
      </ul>
    </div>
    <a href="https://explore-education-statistics.service.gov.uk/" title="Explore education statistics" class="quarto-navigation-tool px-1" aria-label="Explore education statistics" target="_blank"><i class="bi bi-graph-up"></i></a>
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-2" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-2">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://github.com/dfe-analytical-services/analysts-guide" target="_blank">
            Source code
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://github.com/dfe-analytical-services/analysts-guide/issues/new" target="_blank">
            Suggest changes
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Learning resources</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../learning-development/learning-support.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Learning support</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../learning-development/sql.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SQL</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../learning-development/r.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../learning-development/git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Git</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../learning-development/python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../learning-development/accessibility.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Accessibility</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Statistics production</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistics-production/pub.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Routes for publishing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RAP/rap-statistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RAP for Statistics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistics-production/ud.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Open Data Standards</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistics-production/api-data-standards.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistics API Data Standards</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistics-production/ees.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Explore education statistics (EES)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistics-production/examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Good examples in EES</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistics-production/embedded-charts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Embedded visualisations in EES</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistics-production/scrums.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Publication scrums</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistics-production/user-eng.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">User engagement</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistics-production/user-analytics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">EES analytics</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Writing and visualising</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../writing-visualising/dashboards.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Public dashboards</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../writing-visualising/dashboards_rshiny.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Creating R Shiny dashboards</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../writing-visualising/visualising.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Visualising data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../writing-visualising/writing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Writing about data</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Reproducible Analytical Pipelines (RAP)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RAP/rap-expectations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RAP expectations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RAP/rap-support.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RAP support</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RAP/rap-faq.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RAP FAQs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../RAP/rap-statistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RAP for Statistics</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">ADA and Databricks</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
 <span class="menu-text">Understanding Databricks</span>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ADA/ada.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analytical Data Access (ADA) and Databricks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ADA/databricks_fundamentals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Databricks fundamentals</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ADA/databricks_notebooks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Databricks notebooks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ADA/databricks_workflows.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Databricks workflows</span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
 <span class="menu-text">How to...</span>
  </li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ADA/databricks_rstudio_sql_warehouse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Set up Databricks SQL Warehouse with RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ADA/databricks_rstudio_personal_cluster.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Set up Databricks personal compute cluster with RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ADA/git_databricks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Use Databricks with Git</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ADA/databricks_workflow_script_databricks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Script workflows in Databricks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ADA/databricks_workflow_script_rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Script workflows in RStudio</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#what-is-r" id="toc-what-is-r" class="nav-link active" data-scroll-target="#what-is-r">What is R</a></li>
  <li><a href="#what-is-r-for" id="toc-what-is-r-for" class="nav-link" data-scroll-target="#what-is-r-for">What is R for</a></li>
  <li><a href="#how-to-install-r" id="toc-how-to-install-r" class="nav-link" data-scroll-target="#how-to-install-r">How to install R</a></li>
  <li><a href="#best-places-to-start" id="toc-best-places-to-start" class="nav-link" data-scroll-target="#best-places-to-start">Best places to start</a></li>
  <li><a href="#best-practice" id="toc-best-practice" class="nav-link" data-scroll-target="#best-practice">Best practice</a></li>
  <li><a href="#how-to-work-with-r" id="toc-how-to-work-with-r" class="nav-link" data-scroll-target="#how-to-work-with-r">How to work with R</a>
  <ul class="collapse">
  <li><a href="#r-projects" id="toc-r-projects" class="nav-link" data-scroll-target="#r-projects">R Projects</a></li>
  <li><a href="#outlines" id="toc-outlines" class="nav-link" data-scroll-target="#outlines">Outlines</a></li>
  <li><a href="#renv" id="toc-renv" class="nav-link" data-scroll-target="#renv">renv</a></li>
  </ul></li>
  <li><a href="#quick-reference-lookup" id="toc-quick-reference-lookup" class="nav-link" data-scroll-target="#quick-reference-lookup">Quick reference lookup</a></li>
  <li><a href="#other-resources" id="toc-other-resources" class="nav-link" data-scroll-target="#other-resources">Other resources</a></li>
  <li><a href="#excel-functions-in-r" id="toc-excel-functions-in-r" class="nav-link" data-scroll-target="#excel-functions-in-r">Excel functions in R</a></li>
  <li><a href="#sql-function-equivalents-in-r" id="toc-sql-function-equivalents-in-r" class="nav-link" data-scroll-target="#sql-function-equivalents-in-r">SQL function equivalents in R</a></li>
  <li><a href="#interacting-with-a-sql-database-from-within-r-scripts" id="toc-interacting-with-a-sql-database-from-within-r-scripts" class="nav-link" data-scroll-target="#interacting-with-a-sql-database-from-within-r-scripts">Interacting with a SQL database from within R-scripts</a>
  <ul class="collapse">
  <li><a href="#executing-sql-scripts-from-within-r" id="toc-executing-sql-scripts-from-within-r" class="nav-link" data-scroll-target="#executing-sql-scripts-from-within-r">Executing SQL scripts from within R</a></li>
  <li><a href="#using-dbplyr-to-create-database-queries" id="toc-using-dbplyr-to-create-database-queries" class="nav-link" data-scroll-target="#using-dbplyr-to-create-database-queries">Using dbplyr to create database queries</a></li>
  <li><a href="#common-issues-interacting-with-a-sql-database-from-within-r" id="toc-common-issues-interacting-with-a-sql-database-from-within-r" class="nav-link" data-scroll-target="#common-issues-interacting-with-a-sql-database-from-within-r">Common issues interacting with a SQL database from within R</a></li>
  </ul></li>
  <li><a href="#tips-for-using-r" id="toc-tips-for-using-r" class="nav-link" data-scroll-target="#tips-for-using-r">Tips for using R</a>
  <ul class="collapse">
  <li><a href="#specifying-a-version-of-r-to-use" id="toc-specifying-a-version-of-r-to-use" class="nav-link" data-scroll-target="#specifying-a-version-of-r-to-use">Specifying a version of R to use</a></li>
  <li><a href="#rounding" id="toc-rounding" class="nav-link" data-scroll-target="#rounding">Rounding</a></li>
  <li><a href="#making-maps" id="toc-making-maps" class="nav-link" data-scroll-target="#making-maps">Making maps</a></li>
  <li><a href="#passing-variables-as-arguments" id="toc-passing-variables-as-arguments" class="nav-link" data-scroll-target="#passing-variables-as-arguments">Passing variables as arguments</a></li>
  <li><a href="#reverse-additive-filters" id="toc-reverse-additive-filters" class="nav-link" data-scroll-target="#reverse-additive-filters">Reverse additive filters</a></li>
  <li><a href="#file-locations" id="toc-file-locations" class="nav-link" data-scroll-target="#file-locations">File locations</a></li>
  <li><a href="#interweaving-vectors" id="toc-interweaving-vectors" class="nav-link" data-scroll-target="#interweaving-vectors">Interweaving vectors</a></li>
  <li><a href="#making-charts-interactive" id="toc-making-charts-interactive" class="nav-link" data-scroll-target="#making-charts-interactive">Making charts interactive</a></li>
  <li><a href="#replace-all-values-with-another" id="toc-replace-all-values-with-another" class="nav-link" data-scroll-target="#replace-all-values-with-another">Replace all values with another</a></li>
  <li><a href="#temporary-groups" id="toc-temporary-groups" class="nav-link" data-scroll-target="#temporary-groups">Temporary groups</a></li>
  <li><a href="#finding-package-dependencies" id="toc-finding-package-dependencies" class="nav-link" data-scroll-target="#finding-package-dependencies">Finding package dependencies</a></li>
  <li><a href="#visualise-dependencies" id="toc-visualise-dependencies" class="nav-link" data-scroll-target="#visualise-dependencies">Visualise dependencies</a></li>
  <li><a href="#reproducible-random-numbers" id="toc-reproducible-random-numbers" class="nav-link" data-scroll-target="#reproducible-random-numbers">Reproducible random numbers</a></li>
  <li><a href="#automatic-logging" id="toc-automatic-logging" class="nav-link" data-scroll-target="#automatic-logging">Automatic logging</a></li>
  </ul></li>
  <li><a href="#troubleshooting" id="toc-troubleshooting" class="nav-link" data-scroll-target="#troubleshooting">Troubleshooting</a>
  <ul class="collapse">
  <li><a href="#cant-find-make-error" id="toc-cant-find-make-error" class="nav-link" data-scroll-target="#cant-find-make-error">Can’t find make error</a></li>
  <li><a href="#packages-not-downloading-due-to-wininet-error-renv-0.17" id="toc-packages-not-downloading-due-to-wininet-error-renv-0.17" class="nav-link" data-scroll-target="#packages-not-downloading-due-to-wininet-error-renv-0.17">Packages not downloading due to “wininet” error (renv 0.17)</a></li>
  <li><a href="#ssl-certificate-errors" id="toc-ssl-certificate-errors" class="nav-link" data-scroll-target="#ssl-certificate-errors">SSL certificate errors</a></li>
  <li><a href="#shinytest2---invalid-path-to-chrome-chromote-error-message" id="toc-shinytest2---invalid-path-to-chrome-chromote-error-message" class="nav-link" data-scroll-target="#shinytest2---invalid-path-to-chrome-chromote-error-message">shinytest2 - Invalid path to Chrome (chromote) error message</a></li>
  </ul></li>
  <li><a href="#using-r-with-ada-databricks" id="toc-using-r-with-ada-databricks" class="nav-link" data-scroll-target="#using-r-with-ada-databricks">Using R with ADA / Databricks</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/dfe-analytical-services/analysts-guide/edit/main/learning-development/r.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/dfe-analytical-services/analysts-guide/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../learning-development/learning-support.html">Learning resources</a></li><li class="breadcrumb-item"><a href="../learning-development/r.html">R</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">R</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p class="text-muted">
Guidance and tips for using the programming language R
</p>
<hr>
<section id="what-is-r" class="level2">
<h2 class="anchored" data-anchor-id="what-is-r">What is R</h2>
<p>R is an open-source programming language specifically aimed at statisticians and data analysts.</p>
<hr>
</section>
<section id="what-is-r-for" class="level2">
<h2 class="anchored" data-anchor-id="what-is-r-for">What is R for</h2>
<p>R can be used for almost anything you can think of, notably data analysis, data visualisation, and creating reports and dashboards. It can also be used to extract data from SQL databases and run SQL queries.</p>
<hr>
</section>
<section id="how-to-install-r" class="level2">
<h2 class="anchored" data-anchor-id="how-to-install-r">How to install R</h2>
<p>Download R (language) and RStudio (IDE) from the DfE software center. We also recommend that you download RTools (a helpful R extension) at the same time.</p>
<!-- gif getting this from the software center -->
<hr>
</section>
<section id="best-places-to-start" class="level2">
<h2 class="anchored" data-anchor-id="best-places-to-start">Best places to start</h2>
<ul>
<li><p>The DfE Analytics Academy host an <a href="https://educationgovuk.sharepoint.com/sites/AnalyticsAcademy798" target="_blank" rel="noopener noreferrer">online R training course on SharePoint</a>. This is a great resource full of reproducible examples using DfE data. The course takes you through initially getting R downloaded, all the way through to developing apps in RShiny.<br>
</p></li>
<li><p>There is also the <a href="https://dfe-analytical-services.github.io/r-training-course/" target="_blank" rel="noopener noreferrer">DfE R training guide</a>, which is a great starting point and reference to guide you through how to get started using R and RStudio.</p></li>
<li><p>As an alternative, with a number of options for beginners to R, <a href="https://education.rstudio.com/learn/beginner/" target="_blank" rel="noopener noreferrer">RStudio Education</a> provide a variety of materials to suit different learning styles.</p></li>
</ul>
<hr>
</section>
<section id="best-practice" class="level2">
<h2 class="anchored" data-anchor-id="best-practice">Best practice</h2>
<p>Tips for reaching best practice in R can be found on our <a href="../RAP/rap-statistics.html#clean-final-code">RAP for Statistics page</a>, with guidance on meeting best practice in RAP for clean final code. This makes it easier to read and pick up if another person is running your code.</p>
<hr>
</section>
<section id="how-to-work-with-r" class="level2">
<h2 class="anchored" data-anchor-id="how-to-work-with-r">How to work with R</h2>
<section id="r-projects" class="level3">
<h3 class="anchored" data-anchor-id="r-projects">R Projects</h3>
<hr>
<p>Whenever you are using R, you should work in an RProject. This just makes sure you are set up in the correct working directory, so your code is pointing at the right folders and files.</p>
<p><a href="https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects" target="_blank" rel="noopener noreferrer">This guide for using projects in R</a> is a really useful article to help you set up a project.</p>
<p>You can check which project you are working in by looking in the top right hand corner of RStudio:</p>
<p><img src="../images/Rproj.png" class="img-fluid"></p>
<hr>
</section>
<section id="outlines" class="level3">
<h3 class="anchored" data-anchor-id="outlines">Outlines</h3>
<hr>
<p>In RStudio you can greatly increase the navigability of your code by taking advantage of outlines. <a href="https://support.rstudio.com/hc/en-us/articles/200484568-Code-Folding-and-Sections" target="_blank" rel="noopener noreferrer">More information on folding and navigating outlines in RStudio</a> can be found online, though when using rmarkdown reports, remember to use names first, such as <code>## Rows that aren't matching: r nrow(joined %&gt;% filter(matching == FALSE))</code>, rather than having the R code first, so that they are easy to discern in the outline.</p>
<hr>
</section>
<section id="renv" class="level3">
<h3 class="anchored" data-anchor-id="renv">renv</h3>
<hr>
<p>You should use the <a href="https://rstudio.github.io/renv/articles/renv.html" target="_blank" rel="noopener noreferrer">renv package</a> for package and version control in R.</p>
<p>Packages and versions of R regularly update. Over time, this can cause code to break - e.g.&nbsp;if different dependencies are required for later versions of packages to work. Using renv creates a “snapshot” of your code and packages at the time you created it, which anyone can then recreate when they come to use your code.</p>
<p>This is really important for reproducibility, and will help you meet elements of great practice with <a href="../RAP/rap.html#recyclable-code-for-future-use">recyclable code for future use</a>.</p>
<hr>
<section id="renvrestore" class="level4">
<h4 class="anchored" data-anchor-id="renvrestore">renv::restore()</h4>
<hr>
<p>Sometimes renv::restore() can fail, and when in specific renv-controlled projects install.packages() will fail saying that packages aren’t available even when they clearly are. There are a couple of workarounds we have found that get around this failure.</p>
<ol type="1">
<li>Configuring the proxy settings by running the below in R - this also helps if you are getting timeout issues when trying to webscrape with R:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">no_proxy=</span><span class="st">"*"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Specifying the renv library as the install location. It’s a bit of a fudge, though these lines are helpful to get the packages from the renv lockfile installed and you running the project when needed:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>myPath <span class="ot">&lt;-</span> <span class="fu">.libPaths</span>()[<span class="dv">1</span>]</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>forceInstall <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg, path) {</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>missing <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text=</span> <span class="fu">paste0</span>(<span class="st">"!require("</span>,pkg,<span class="st">")"</span>))))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(missing <span class="sc">==</span> <span class="cn">FALSE</span>){</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(pkg, <span class="st">" is already installed."</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span>{</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(pkg, <span class="at">lib =</span> path)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">forceInstall</span>(<span class="st">"jsonlite"</span>, myPath)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>renvPackages <span class="ot">&lt;-</span> <span class="fu">names</span>(jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(<span class="st">"renv.lock"</span>, <span class="at">flatten =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>Packages)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">lapply</span>(renvPackages, forceInstall, <span class="at">path =</span> myPath))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>More manual equivalent to use for specific packages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.libPaths</span>() <span class="co"># note down output 1, and reuse in the lib argument of install.packages() as below</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"rmarkdown"</span>, <span class="at">lib =</span> <span class="st">"C:/Users/swong/OneDrive - Department for Education/Documents/stats-production-guidance/renv/library/R-4.0/x86_64-w64-mingw32"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="updating-packages-in-renv" class="level4">
<h4 class="anchored" data-anchor-id="updating-packages-in-renv">Updating packages in renv</h4>
<hr>
<p>To update a single package run:</p>
<p><code>renv::update("dplyr")</code></p>
<p>To update all packages run:</p>
<p><code>renv::update()</code></p>
<hr>
</section>
<section id="installing-old-package-versions-in-renv" class="level4">
<h4 class="anchored" data-anchor-id="installing-old-package-versions-in-renv">Installing old package versions in renv</h4>
<hr>
<p>This is surprisingly neat to do. Let’s say you wanted to roll back to version 1.0.2 of dplyr, you would run the following:</p>
<p><code>renv::install("dplyr@1.0.2")</code></p>
<hr>
</section>
</section>
</section>
<section id="quick-reference-lookup" class="level2">
<h2 class="anchored" data-anchor-id="quick-reference-lookup">Quick reference lookup</h2>
<ul>
<li>If you want a useful guide for R syntax or functions, then look no further than the <a href="https://rstudio.com/resources/cheatsheets/" target="_blank" rel="noopener noreferrer">R cheat sheets</a>, these can be an invaluable point of reference. Below we’ve included a few particularly relevant ones:
<ul>
<li>Introduction to the <a href="https://rstudio.github.io/cheatsheets/html/rstudio-ide.html" target="_blank" rel="noopener noreferrer">RStudio environment</a></li>
<li><a href="https://rstudio.github.io/cheatsheets/base-r.pdf" target="_blank" rel="noopener noreferrer">Base R</a></li>
<li><a href="https://rstudio.github.io/cheatsheets/html/data-transformation.html" target="_blank" rel="noopener noreferrer">dplyr</a> for data manipulation</li>
<li><a href="https://rstudio.github.io/cheatsheets/html/data-import.html" target="_blank" rel="noopener noreferrer">Data import with the tidyverse</a></li>
<li><a href="https://rstudio.github.io/cheatsheets/html/strings.html" target="_blank" rel="noopener noreferrer">stringr</a> for string manipulation</li>
<li><a href="https://rstudio.github.io/cheatsheets/regex.pdf" target="_blank" rel="noopener noreferrer">Regex</a></li>
<li><a href="https://rstudio.github.io/cheatsheets/html/rmarkdown.html" target="_blank" rel="noopener noreferrer">RMarkdown</a></li>
<li><a href="https://rstudio.github.io/cheatsheets/html/shiny.html" target="_blank" rel="noopener noreferrer">RShiny</a></li>
<li><a href="https://rstudio.github.io/cheatsheets/html/data-visualization.html" target="_blank" rel="noopener noreferrer">ggplot2</a> for data visualisations</li>
<li><a href="https://rstudio.github.io/cheatsheets/html/purrr.html" target="_blank" rel="noopener noreferrer">purrr</a> for applying functions</li>
</ul></li>
</ul>
<hr>
</section>
<section id="other-resources" class="level2">
<h2 class="anchored" data-anchor-id="other-resources">Other resources</h2>
<ul>
<li><p>Here is another free introduction to R course by <a href="https://www.quantargo.com/courses/course-r-introduction/" target="_blank" rel="noopener noreferrer">Quantargo</a>.</p></li>
<li><p><a href="https://bookdown.org/yihui/rmarkdown/" target="_blank" rel="noopener noreferrer">R Markdown: The Definitive Guide</a>, hopefully this one should be relatively self-explanatory!</p></li>
<li><p><a href="https://datascienceineducation.com/" target="_blank" rel="noopener noreferrer">Data science in education</a> provides a heavily detailed guide for beginners in R learning to process data, with some well written out sections that may be of interest.</p></li>
<li><p>Handy guide to <a href="https://support.rstudio.com/hc/en-us/articles/200484568-Code-Folding-and-Sections" target="_blank" rel="noopener noreferrer">collapsing and sectioning R code</a> for easy navigation in RStudio.</p></li>
<li><p>Here are <a href="https://towardsdatascience.com/five-tidyverse-tricks-you-may-not-know-about-c5026d5a19da" target="_blank" rel="noopener noreferrer">5 handy tidyverse functions</a> that you should know if you’re using R to process data. Number two is especially useful for those processing wide data into a tidy format!</p></li>
<li><p>MoJ have produced <a href="https://github.com/moj-analytical-services/writing_functions_in_r" target="_blank" rel="noopener noreferrer">guidance on writing functions in R</a></p></li>
<li><p>If you’re wondering how best to make the jump to R from Excel and SQL, take a look at this <a href="https://educationgovuk.sharepoint.com/sites/sarpi/g/WorkplaceDocuments/Forms/AllItems.aspx?FolderCTID=0x012000C61C1076C17C5547A6D6D8C2A27B5D97&amp;View=%7B2B35083D%2D7626%2D48E2%2D9615%2D451544742692%7D&amp;id=%2Fsites%2Fsarpi%2Fg%2FWorkplaceDocuments%2FInducation%20learning%20and%20career%20development%2FCoffee%20and%20Coding%2F181121%5FDavd%5FExceltoR%2FSQL%5FEXCEL%5Fto%5FR%5FHow%5Fto%5FMake%5Fthe%5FJump%2Ehtml&amp;parent=%2Fsites%2Fsarpi%2Fg%2FWorkplaceDocuments%2FInducation%20learning%20and%20career%20development%2FCoffee%20and%20Coding%2F181121%5FDavd%5FExceltoR" target="_blank" rel="noopener noreferrer">coffee and coding presention</a> by David Sands.</p></li>
<li><p>Malcolm Barrett has done some slides on <a href="https://malco.io/slides/hs_dplyr/#1" target="_blank" rel="noopener noreferrer">dplyr</a>, <a href="https://malco.io/slides/hs_ggplot2/#1" target="_blank" rel="noopener noreferrer">ggplot2</a>, and using <a href="https://lar-purrr.netlify.app/#1" target="_blank" rel="noopener noreferrer">purrr</a> which may be useful if you’re looking at learning more about any of those packages.</p></li>
<li><p>Also check out the <a href="https://garthtarr.github.io/meatR/janitor.html" target="_blank" rel="noopener noreferrer">janitor</a> package, it has some particularly powerful functions that are worth a look for tidying and QA’ing data.</p></li>
</ul>
<hr>
</section>
<section id="excel-functions-in-r" class="level2">
<h2 class="anchored" data-anchor-id="excel-functions-in-r">Excel functions in R</h2>
<p>R can do everything you do in excel, but takes out the human error. The reference table below shows how you would carry out popular Excel commands in R.</p>
<p>R comes in with a built-in dataset called “iris”. We’ll use this for all examples so you can recreate them in your local area.</p>
<p><strong>REMEMBER:</strong> R is case sensitive, so all references to column names/entries need to be as-is in the dataset you are looking at. <a href="https://www.rdocumentation.org/packages/janitor/versions/1.2.0/topics/clean_names" target="_blank">Functions exist</a> that can translate all your columns to lower or snake case for ease!</p>
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 63%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Common Excel Task</strong></th>
<th><strong>Example with iris </strong></th>
<th><strong>How to do in R with dplyr</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Select specific columns</strong></td>
<td>Select only species and petal length</td>
<td><code>iris %&gt;% select(Species, Petal.Length)</code></td>
</tr>
<tr class="even">
<td><strong>List unique entries in field (column)</strong></td>
<td>Find the unique entries for the “Species” column in iris</td>
<td><code>iris %&gt;% select(Species) %&gt;% distinct()</code></td>
</tr>
<tr class="odd">
<td><strong>Filter/select based on criteria</strong></td>
<td>Filter for sepal length &gt;4 and sepal width &lt;2.5, but NOT “versicolor” species</td>
<td><code>iris %&gt;% filter(Sepal.Length &gt; 4 &amp;</code> <br> <code>Sepal.Width &lt;2.5 &amp; Species != "versicolor")</code></td>
</tr>
<tr class="even">
<td><strong>Filter for multiple criteria in same column</strong></td>
<td>Filter for all “setosa” and “versicolor” species</td>
<td><code>iris %&gt;% filter(Species %in% c("setosa", "versicolor")</code></td>
</tr>
<tr class="odd">
<td><strong>If else with OR</strong></td>
<td>Create new column called “size_group” based on length or width of petal</td>
<td><code>iris %&gt;% mutate(size_group =</code><br><code>if_else( Petal.Length &gt; 4 | Petal.Width &gt;1.5, "Large", "Small"))</code></td>
</tr>
<tr class="even">
<td><strong>Multiple if else</strong></td>
<td>Create new column called “flower_price” based on species and petal length</td>
<td><code>iris %&gt;%  mutate(flower_price = case_when(</code> <br> <code>Species == "setosa" &amp; Petal.Length &gt; 1.5 ~"top band",</code><br><code>Species == "versicolor" &amp; Petal.Length &lt; 4 ~"low_band",</code><br> <code>TRUE ~ "mid_band"))</code></td>
</tr>
<tr class="odd">
<td><strong>COUNTIF</strong></td>
<td>Count the number of species if they have a petal length &gt;1.5</td>
<td><code>iris %&gt;% filter(Petal.Length &gt; 1.5 ) %&gt;%</code><br><code>group_by(Species) %&gt;% count()</code></td>
</tr>
<tr class="even">
<td><strong>SUMIF</strong></td>
<td>Sum petal width of species if sepal width &lt;3</td>
<td><code>iris %&gt;% filter(Sepal.Width &lt;3) %&gt;%</code><br><code>group_by(Species) %&gt;%</code><br><code>summarise(Petal.Width = sum(Petal.Width))</code></td>
</tr>
<tr class="odd">
<td><strong>VLOOKUP</strong></td>
<td>Lookup to a table called “lookup”</td>
<td><code>iris %&gt;%  left_join(lookup, by.x="Species", by.y ="plant_species")</code></td>
</tr>
<tr class="even">
<td><strong>Order by</strong></td>
<td>Order dataset by descending petal width</td>
<td><code>iris %&gt;% arrange(desc(Petal.Width))</code></td>
</tr>
</tbody>
</table>
<p>More tips for moving from using Excel to using R can be found in the <a href="https://github.com/dfe-analytical-services/excel-to-R/wiki/Excel-to-R---how-do-I..." target="_blank">excel-to-R wiki</a>.</p>
<hr>
</section>
<section id="sql-function-equivalents-in-r" class="level2">
<h2 class="anchored" data-anchor-id="sql-function-equivalents-in-r">SQL function equivalents in R</h2>
<p>R can do a lot of the things that are possible in SQL. The reference table below shows how you would carry out some popular SQL commands in R.</p>
<p><strong>REMEMBER:</strong> R is case sensitive, so all references to column names/entries need to be as-is in the dataset you are looking at. <a href="https://www.rdocumentation.org/packages/janitor/versions/1.2.0/topics/clean_names" target="_blank">Functions exist</a> that can translate all your columns to lower or snake case for ease!</p>
<table class="caption-top table">
<colgroup>
<col style="width: 47%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th>Common SQL Task</th>
<th>How to do in R (with dplyr)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>SELECT * FROM TABLE</strong></td>
<td><code>table %&gt;% select()</code></td>
</tr>
<tr class="even">
<td><strong>SELECT ColA, ColB, ColC FROM TABLE</strong></td>
<td><code>table %&gt;% select(ColA, ColB, ColC)</code></td>
</tr>
<tr class="odd">
<td><strong>SELECT DISTINCT ColA FROM TABLE</strong></td>
<td><code>table %&gt;% select(ColA) %&gt;% distinct()</code></td>
</tr>
<tr class="even">
<td><strong>TABLE A LEFT JOIN (TABLE B) ON TABLEA.x = TABLEB.y</strong></td>
<td><code>tableA %&gt;% left_join(TableB, by = c(x = y))</code></td>
</tr>
<tr class="odd">
<td><strong>CASE WHEN x = 1 THEN 1, WHEN x =2 THEN 2, ELSE 0 END AS New_column_name</strong></td>
<td><code>%&gt;% mutate (New_column_name = case_when (x == 1 ~ 1, x == 2 ~ 2, TRUE ~ 0))</code></td>
</tr>
<tr class="even">
<td><strong>CONCAT(LEA, ESTAB) AS LAESTAB</strong></td>
<td><code>%&gt;% mutate(LAESTAB = paste0(LEA, ESTAB))</code></td>
</tr>
<tr class="odd">
<td><strong>SELECT COUNT(*) FROM TABLE</strong></td>
<td><code>table %&gt;% nrow()</code></td>
</tr>
<tr class="even">
<td><strong>SELECT COUNT(ColA) FROM TABLE</strong></td>
<td><code>table %&gt;% count(colA)</code></td>
</tr>
<tr class="odd">
<td><strong>SELECT Date_column = CONVERT(DATE, Date_column) FROM TABLE</strong></td>
<td><code>table %&gt;% mutate(Date_column = as.Date(Date_column))</code></td>
</tr>
<tr class="even">
<td><strong>SELECT Number_column = CONVERT(INT, Number_column ) FROM TABLE</strong></td>
<td><code>table %&gt;% mutate(Number_column = as.numeric(Number_column))</code></td>
</tr>
<tr class="odd">
<td><strong>SELECT String_column = CONVERT(VARCHAR, String_column ) FROM TABLE</strong></td>
<td><code>table %&gt;% mutate(String_column = as.character(String_column))</code></td>
</tr>
<tr class="even">
<td><strong>DROP TableA</strong></td>
<td><code>rm(TableA)</code></td>
</tr>
</tbody>
</table>
<p>More tips for moving from using SQL to using R can be found in the <a href="https://github.com/dfe-analytical-services/excel-to-R/wiki/SQL-to-R-how-do-I..." target="_blank">SQL-to-R wiki</a>.</p>
<hr>
</section>
<section id="interacting-with-a-sql-database-from-within-r-scripts" class="level2">
<h2 class="anchored" data-anchor-id="interacting-with-a-sql-database-from-within-r-scripts">Interacting with a SQL database from within R-scripts</h2>
<p>R can be used to execute SQL scripts to extract data from a database as well as querying the database directly via R. There are two primary ways to do this:</p>
<ol type="1">
<li>executing a SQL script as is within R and</li>
<li>using dbplyr to create SQL code for you.</li>
</ol>
<p>Which you use will depend on how comfortable with SQL and R and also if you already have existing SQL scripts that you want to execute or you’re writing new database queries.</p>
<hr>
<section id="executing-sql-scripts-from-within-r" class="level3">
<h3 class="anchored" data-anchor-id="executing-sql-scripts-from-within-r">Executing SQL scripts from within R</h3>
<hr>
<p>This is primarily useful if you already have existing SQL scripts that you want to build into an R controlled pipeline. For using R to execute a SQL script you’ll need the SQL script/s to be in your R Project and to make a connection via R to the database.</p>
<p>Example code and a walkthrough guide is available in the <a href="https://dfe-analytical-services.github.io/dfeR/articles/connecting_to_sql.html" target="_blank">Connecting to SQL page in the dfeR package documentation</a>.</p>
<hr>
</section>
<section id="using-dbplyr-to-create-database-queries" class="level3">
<h3 class="anchored" data-anchor-id="using-dbplyr-to-create-database-queries">Using dbplyr to create database queries</h3>
<hr>
<p>If you’re familiar with dplyr then using the dbplyr package to interact with a SQL database is a good way to go. It allows you to use common dplyr functions such as <code>select()</code>, <code>filter()</code>, <code>mutate()</code>, <code>group_by()</code>, <code>summarise()</code> and <code>arrange()</code> with a SQL database.</p>
<p>As with sending a SQL script, you’ll need to create the connection to the database as shown in the <a href="https://dfe-analytical-services.github.io/dfeR/articles/connecting_to_sql.html" target="_blank">dfeR package</a> and then create piped queries as you would with dplyr:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Library calls ====</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(odbc)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dbplyr)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># DB connection ====</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbConnect</span>(odbc<span class="sc">::</span><span class="fu">odbc</span>(),</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Driver =</span> <span class="st">"ODBC Driver 17 for SQL Server"</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Server =</span> <span class="st">"server_name"</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Database =</span> <span class="st">"database_name"</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">UID =</span> <span class="st">""</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">PWD =</span> <span class="st">""</span>,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Trusted_Connection =</span> <span class="st">"Yes"</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>query_result <span class="ot">&lt;-</span> <span class="fu">collect</span>(</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl</span>(con, <span class="fu">Id</span>(<span class="at">schema=</span><span class="st">'dbo'</span>, <span class="at">table=</span><span class="st">'table_name'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(example_id_column, example_filter_column, example_indicator_column) <span class="sc">%&gt;%</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(example_filter_column<span class="sc">==</span><span class="st">'Filter entry 1'</span>, example_indicator_column <span class="sc">&lt;=</span> <span class="dv">120</span>)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The key differences to just using dplyr with a data frame are:</p>
<ul>
<li>we use tbl() to point to the SQL table on the SQL database in place of supplying a data-frame</li>
<li>we use the collect() function to tell R to collate the commands and run them on the SQL database</li>
</ul>
<hr>
</section>
<section id="common-issues-interacting-with-a-sql-database-from-within-r" class="level3">
<h3 class="anchored" data-anchor-id="common-issues-interacting-with-a-sql-database-from-within-r">Common issues interacting with a SQL database from within R</h3>
<hr>
<section id="dbi-varcharmax-column-ordering-bug" class="level4">
<h4 class="anchored" data-anchor-id="dbi-varcharmax-column-ordering-bug">DBI varchar(max) column ordering bug</h4>
<p>A known bug in DBI is that if a SQL table contains columns of type varchar(max), then any queries including those columns will fail if those columns aren’t the last to be called in the query. This is a bit esoteric, but you can identify this issue if you’re getting the following error message when you run your query:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>Error<span class="sc">:</span> nanodbc<span class="sc">/</span>nanodbc.cpp<span class="sc">:</span><span class="dv">3166</span><span class="sc">:</span> <span class="dv">07009</span><span class="sc">:</span> [Microsoft][SQL Server Native Client <span class="fl">11.0</span>]Invalid Descriptor Index </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>Warning message<span class="sc">:</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>In <span class="fu">dbClearResult</span>(rs) <span class="sc">:</span> Result already cleared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are a couple of solutions to this:</p>
<ul>
<li>avoid creating tables containing varchar(max) columns (i.e.&nbsp;always set a field length for your character fields)</li>
<li>make sure all varchar(max) columns are placed last in ay select query that you write</li>
</ul>
<p>This latter route can be automated using the following function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>tbl_fix_nvarchar <span class="ot">&lt;-</span> <span class="cf">function</span>(con, schema, table){</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  column.types <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    con,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">"SELECT COLUMN_NAME, DATA_TYPE, CHARACTER_MAXIMUM_LENGTH FROM INFORMATION_SCHEMA.COLUMNS "</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">"WHERE TABLE_NAME='"</span>,table,<span class="st">"'"</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  ct <span class="ot">&lt;-</span> column.types <span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cml =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(CHARACTER_MAXIMUM_LENGTH) <span class="sc">~</span> <span class="dv">10</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>      CHARACTER_MAXIMUM_LENGTH <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">~</span> <span class="dv">100000</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.double</span>(CHARACTER_MAXIMUM_LENGTH)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(cml) <span class="sc">%&gt;%</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(COLUMN_NAME)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl</span>(con, <span class="fu">Id</span>(<span class="at">schema=</span>schema, <span class="at">table=</span>table)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(ct))</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This queries the properties of the SQL table that you’re interacting with, identifies any varchar(max) columns (i.e.&nbsp;where CHARACTER_MAXIMUM_LENGTH equals 1) and then creates a column ordering in your query whereby any varchar(max) columns present are placed to the end.</p>
</section>
</section>
</section>
<section id="tips-for-using-r" class="level2">
<h2 class="anchored" data-anchor-id="tips-for-using-r">Tips for using R</h2>
<p>A selection of handy bits of code and workarounds for common issues. More useful code snippets can also be found in our <a href="https://github.com/dfe-analytical-services/automated-data-qa" target="_blank" rel="noopener noreferrer">github repo</a></p>
<hr>
<section id="specifying-a-version-of-r-to-use" class="level3">
<h3 class="anchored" data-anchor-id="specifying-a-version-of-r-to-use">Specifying a version of R to use</h3>
<hr>
<p>This can be done most easily by navigating in RStudio through <code>Tools &gt; Global options &gt; General &gt; Basic &gt; R version (change)</code>. It’s likely you’ll need to restart RStudio for the changes to take affect.</p>
<hr>
</section>
<section id="rounding" class="level3">
<h3 class="anchored" data-anchor-id="rounding">Rounding</h3>
<hr>
<p>The base R function of <code>round()</code> can behave unusually due to the way numbers are stored within R itself. <code>round()</code> is supposed to use a ‘banker’s round’, in which mid-point values (e.g.&nbsp;0.5, 1.5, 2.5) are rounded to the closest even number. For example, using <code>round()</code>, 1.5 should round to 2, but 2.5 should also round to 2. This is different than the way in which SQL performs rounding, which is always to round numbers at the mid-way point up to the next number (e.g.&nbsp;2.5 rounds to 3).</p>
<p>However, when investigating numbers in R, you can see that they are not always stored in the way you might think. This is due to floating point numbers. Whilst humans use base 10 (numbers 0-9), computers store numbers in a binary (base 2) system as a combinations of 1s and 0s. When translating between base 2 and base 10, sometimes numbers can be not quite what we expect. For example, asking R to print the number 1.4 to 18 decimal places shows that it is actually stored as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">"%.18f"</span>, <span class="fl">1.4</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"1.399999999999999911"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These slight differences in the floating point numbers behind the scenes can result in unusual rounding errors using round(). If you’re interested, <a href="https://stat.ethz.ch/pipermail/r-help/2007-August/138014.html" target="_blank">there’s more information available in these forum posts</a>.</p>
<p>To round numbers upwards in a way that is consistent with SQL and other programming languages, we recommend using the roundFiveUp() function in the <a href="https://github.com/dfe-analytical-services/dfeR" target="_blank" rel="noopener noreferrer">dfeR R package</a>.</p>
<hr>
</section>
<section id="making-maps" class="level3">
<h3 class="anchored" data-anchor-id="making-maps">Making maps</h3>
<hr>
<section id="boundary-files" class="level4">
<h4 class="anchored" data-anchor-id="boundary-files">Boundary files</h4>
<hr>
<p>Most maps we’ll want to make will be based on boundaries provided from the <a href="https://geoportal.statistics.gov.uk/" target="_blank">Open Geography Portal</a>.</p>
<p>Take heed of the homepage and details on the codes for map resolution, usually the ultra generalised BUC boundaries are the best option for us as they still provide plenty of detail but are far smaller in size than the other formats.</p>
<p>Some examples of commonly used boundary files from the Open Geography Portal (based on latest available at time of writing, always make sure the year of the boundaries is the most relevant for your own data!):</p>
<ul>
<li>Parliamentary Constituency - <a href="https://geoportal.statistics.gov.uk/datasets/ef63f363ac824b79ae9670744fcc4307_0/explore" target="_blank">Westminster Parliamentary Constituencies (July 2024) Boundaries UK BUC</a></li>
<li>Local authority - <a href="https://geoportal.statistics.gov.uk/datasets/4832bb99c4844971b111739be44f1bc5_0/explore" target="_blank">Counties and Unitary Authorities (December 2023) Boundaries UK BUC</a></li>
<li>Local authority district - <a href="https://geoportal.statistics.gov.uk/datasets/fb6ab0ce776243339e45e33444f431c8_0/explore" target="_blank">Local Authority Districts (May 2024) Boundaries UK BUC</a></li>
<li>Local skills improvement areas - <a href="https://geoportal.statistics.gov.uk/datasets/72bd510b46a7483194237ede9db0a267_0/explore" target="_blank">Local Skills Improvement Plan Areas (August 2023) Boundaries EN BUC</a></li>
</ul>
<p>When downloading the boundaries you’ll have a choice of file formats, we’d generally recommend the GeoPackage format as that comes as a single file, though both Shapefile (will get 4/5 files needed to read a single boundary layer) or GeoJSON (sometimes larger file size and needs more processing) are possible options too. There are numerous debates online about these that you can delve into if you so desire.</p>
<p>If you want to edit the boundaries, whether that is to edit the coordinate system, file type or to simplify them at all, have a look at the <a href="https://mapshaper.org/" target="_blank">interactive website for mapshaper</a>, there’s also an accompanying <a href="https://andyteucher.ca/rmapshaper/" target="_blank">rmapshaper R package</a>.</p>
<hr>
</section>
<section id="packages" class="level4">
<h4 class="anchored" data-anchor-id="packages">Packages</h4>
<hr>
<p>Known package options for building maps are (note this is not an exhaustive list):</p>
<ul>
<li><a href="https://r.geocompx.org/adv-map" target="_blank">base R’s plot function</a></li>
<li><a href="https://cran.r-project.org/web/packages/tmap/vignettes/tmap-getstarted.html" target="_blank">tmap</a></li>
<li><a href="https://rstudio.github.io/leaflet/index.html" target="_blank">leaflet</a></li>
<li><a href="https://walker-data.com/mapgl/" target="_blank">mapgl</a></li>
</ul>
<p>For interactive maps in dashboard <a href="https://rstudio.github.io/leaflet/index.html" target="_blank">leaflet</a> is most frequently used in DfE currently.</p>
<p>The <a href="https://r-spatial.github.io/sf/" target="_blank">sf</a> package is usually needed for processing spatial data in R, be aware that the first time you install this it can take a number of minutes.</p>
<hr>
</section>
<section id="example-shiny-app-with-map" class="level4">
<h4 class="anchored" data-anchor-id="example-shiny-app-with-map">Example shiny app with map</h4>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shiny app ===================================================================</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Minimal example code for a shiny app with interactive map</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Can copy and paste into a single app.R file and run to test</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Pre-processing of data (do this in a separate script to the app) ============</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Load dependencies -----------------------------------------------------------</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet) <span class="co"># using leaflet for the interactive map</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># used for data processing</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf) <span class="co"># used for reading geospatial data</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Pre-process data before app -------------------------------------------------</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an example file using the locations look ups</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>example_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/dfe-analytical-services/dfe-published-data-qa/main/data/lsips.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">example_count =</span> <span class="fu">sample</span>(<span class="dv">38</span>)) <span class="co"># number of rows in data frame</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Pull in boundary data from the Open Geography Portal</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Download GeoPackage format and save in repo from:</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co"># https://geoportal.statistics.gov.uk/datasets/72bd510b46a7483194237ede9db0a267_0/explore</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>boundary_data <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"Local_Skills_Improvement_Plan_Areas_August_2023_Boundaries_EN_BUC_3056517900557747412.gpkg"</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the data together and save ready for the app</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>map_data <span class="ot">&lt;-</span> boundary_data <span class="sc">%&gt;%</span> </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(example_data, <span class="at">by =</span> <span class="fu">join_by</span>(LSIP23CD <span class="sc">==</span> lsip_code)) <span class="sc">%&gt;%</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert coordinates to World Geodetic System </span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(map_data, <span class="st">"map_data.RDS"</span>)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="co"># R Shiny App =================================================================</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Global.R file ---------------------------------------------------------------</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in map data</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>map_data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"map_data.RDS"</span>)</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="co"># ui.R file -------------------------------------------------------------------</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Show interactive map</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">leafletOutput</span>(<span class="st">"example_map"</span>)</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="co"># server.R file ---------------------------------------------------------------</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>example_map <span class="ot">&lt;-</span> <span class="fu">renderLeaflet</span>({</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Set the color scheme and scale</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>      pal_fun <span class="ot">&lt;-</span> <span class="fu">colorNumeric</span>(</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Blues"</span>, </span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">domain =</span> <span class="fu">c</span>(</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>          <span class="fu">min</span>(map_data<span class="sc">$</span>example_count), </span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>          <span class="fu">max</span>(map_data<span class="sc">$</span>example_count)</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Set a pop up</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>      map_popup <span class="ot">&lt;-</span> <span class="fu">paste</span>(</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>        map_data<span class="sc">$</span>example_count, </span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>        <span class="st">" example count for "</span>, </span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>        map_data<span class="sc">$</span>lsip_name</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Create the map </span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>      map <span class="ot">&lt;-</span> <span class="fu">leaflet</span>(</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>        map_data, </span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Take off annoying scrolling, personal preference</span></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>        <span class="at">options =</span> <span class="fu">leafletOptions</span>(<span class="at">scrollWheelZoom =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set the basemap (this is a good neutral one)</span></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>        <span class="fu">addProviderTiles</span>(providers<span class="sc">$</span>CartoDB.PositronNoLabels) <span class="sc">%&gt;%</span></span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add the shaded regions</span></span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>        <span class="fu">addPolygons</span>(</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>          <span class="at">weight =</span> <span class="dv">1</span>,</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>          <span class="at">fillColor =</span> <span class="fu">pal_fun</span>(map_data[[<span class="st">"example_count"</span>]]),</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>          <span class="at">popup =</span> map_popup</span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add a legend to the map</span></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>        <span class="fu">addLegend</span>(<span class="st">"topright"</span>,</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>                  <span class="at">pal =</span> pal_fun,</span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>                  <span class="at">values =</span> <span class="sc">~</span>map_data[[<span class="st">"example_count"</span>]],</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>                  <span class="at">title =</span> <span class="st">"Example map title"</span></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the application ---------------------------------------------------------</span></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="r-shiny-peformance" class="level4">
<h4 class="anchored" data-anchor-id="r-shiny-peformance">R Shiny peformance</h4>
<hr>
<p>Maps can be intensive and slow to process, and when placed in R Shiny dashboards this can sometimes make users have to wait longer than we’d like.</p>
<ol type="1">
<li>Pre-process as much as you can</li>
</ol>
<p>First, it is best to do all the joining and processing you can before the dashboard, and then save the data as an RDS file to read into the app later. This will minimise the processing R has to do in preparing the file.</p>
<ol start="2" type="1">
<li>Simplify the map detail</li>
</ol>
<p>If you’re using a particularly detailed map, you can sometimes simplify the files used to help reduce the size, this will make the map less precise but have a trade off of speeding up the load times. See the <a href="#boundary-files">boundary files</a> section for more information.</p>
<ol start="3" type="1">
<li>Only change the layers you need to</li>
</ol>
<p>If the map layers on top are reactive (e.g.&nbsp;shaded polygons that change based on a user interaction like a dropdown), consider using the <a href="https://rstudio.github.io/leaflet/articles/shiny.html#modifying-existing-maps-with-leafletproxy" target="_blank">leafletProxy function from the Leaflet package</a> to change only the layer you need to while leaving the base map static.</p>
<ol start="4" type="1">
<li>If all else fails, try the magical hammer of caching</li>
</ol>
<p>Caching allows you to save the outputs and then return them without having to run the process again. Caution and thorough testing is advised as this can get complicated and easily lead to bugs, though great rewards lurk beyond the risk. If you’re interested in looking at this route, take a look at the <a href="https://mastering-shiny.org/performance.html#caching" target="_blank">caching section of the mastering shiny guide</a>.</p>
<hr>
</section>
</section>
<section id="passing-variables-as-arguments" class="level3">
<h3 class="anchored" data-anchor-id="passing-variables-as-arguments">Passing variables as arguments</h3>
<hr>
<p>This can be worked around by using a combination of <code>eval()</code> and <code>parse()</code>, as shown in the below function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>showFilterLevels <span class="ot">&lt;-</span> <span class="cf">function</span>(data, meta) {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  filters <span class="ot">&lt;-</span> meta <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(col_type <span class="sc">==</span> <span class="st">"Filter"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(col_name)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  levelsTable <span class="ot">&lt;-</span> <span class="cf">function</span>(filter) {</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> <span class="fu">paste0</span>(<span class="st">"data %&gt;% select("</span>, filter, <span class="st">") %&gt;% distinct()"</span>))))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">lapply</span>(filters, levelsTable)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="reverse-additive-filters" class="level3">
<h3 class="anchored" data-anchor-id="reverse-additive-filters">Reverse additive filters</h3>
<hr>
<p>You might want to filter your dataset based on multiple negative conditions. Normally to filter on multiple conditions, you would use <code>filter(condition1 &amp; condition2)</code>. The “filter” function does not work well with negative conditions (i.e.&nbsp;filtering for cases where condition 1 and condition 2 are not met). Instead, you can use <code>subset(!(condition1 &amp; condition2)</code>.</p>
<hr>
</section>
<section id="file-locations" class="level3">
<h3 class="anchored" data-anchor-id="file-locations">File locations</h3>
<hr>
<p>Struggling to get files to talk to one another, or get code to find and use another R script? Use <code>here::here()</code> and marvel at it’s wondrous ability to magic away issues.</p>
<hr>
</section>
<section id="interweaving-vectors" class="level3">
<h3 class="anchored" data-anchor-id="interweaving-vectors">Interweaving vectors</h3>
<hr>
<p>There’s an easy way to interweave multiple vectors into one single vector using <code>c(rbind())</code>. The example below shows two vectors, but you can have even more if you need.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Two vectors, x and y</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Run code to interweave</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">rbind</span>(x, y))</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Output below</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] 1 4 2 5 3 6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="making-charts-interactive" class="level3">
<h3 class="anchored" data-anchor-id="making-charts-interactive">Making charts interactive</h3>
<hr>
<p>When pulling ggplot charts into RMarkdown reports, you can consider making them even more user-friendly and interactive with plotly. <a href="https://plotly.com/ggplot2" target="_blank" rel="noopener noreferrer">Further information on how to make your charts interactive with plotly</a> can be found online.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Simple ggplot chart called "p"</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x=</span>xvar, <span class="at">y=</span>yvar)) <span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">1</span>)      <span class="co"># Use hollow circles</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Apply ggplotly() to it to make it interactive</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">ggplotly</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="replace-all-values-with-another" class="level3">
<h3 class="anchored" data-anchor-id="replace-all-values-with-another">Replace all values with another</h3>
<hr>
<p>Have you ever needed to replace every value in your data with another? This can come in handy when you are looking at suppression, e.g.&nbsp;converting all NAs to “z” or all values under a certain threshold to “c”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> <span class="fu">mutate_all</span>(<span class="sc">~</span> <span class="fu">replace</span>(., . <span class="sc">==</span> <span class="st">"Value to replace"</span>, <span class="st">"Replacement"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="temporary-groups" class="level3">
<h3 class="anchored" data-anchor-id="temporary-groups">Temporary groups</h3>
<hr>
<p>The group_by() function in dplyr is really useful, but can be fiddly if you only want to use it for one operation in a chunk of code. The with_groups() function from <a href="https://dplyr.tidyverse.org/reference/with_groups.html" target="_blank" rel="noopener noreferrer">dplyr</a> lets you do this, saving you having to group and ungroup data each time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">annual_average =</span> <span class="fu">with_groups</span>(time_period, mean))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="finding-package-dependencies" class="level3">
<h3 class="anchored" data-anchor-id="finding-package-dependencies">Finding package dependencies</h3>
<hr>
<p>Often we’ll take chunks of code and reuse them for new projects. This can lead to building up a long list of packages to install, not all of which end up being used in your new code. The <strong>NCmisc</strong> package is a really handy way to check which packages and functions are used in your code.</p>
<p>Firstly, load up all the packages the code has <code>library()</code> commands for, then run the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list.functions.in.file</span>(<span class="st">'your-filename-here.R'</span>, <span class="at">alphabetic =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="visualise-dependencies" class="level3">
<h3 class="anchored" data-anchor-id="visualise-dependencies">Visualise dependencies</h3>
<hr>
<p>The <a href="https://github.com/crsh/depgraph" target="_blank" rel="noopener noreferrer">depgraph package</a> allows you to plot a graph of all the dependencies in your R project, which can be a useful tool to help you cut down on the number of package dependencies. Briefly, in these graphs you can look for “hot spots” in the network (big bright dots), which represent packages that have many upstream dependencies but are potentially easy to remove because they have few downstream dependencies (that is, only your package depends on them).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_dependency_graph</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">pkg =</span> multibridge_pkg</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  , <span class="at">suggests =</span> <span class="cn">FALSE</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  , <span class="at">option =</span> <span class="st">"cividis"</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="reproducible-random-numbers" class="level3">
<h3 class="anchored" data-anchor-id="reproducible-random-numbers">Reproducible random numbers</h3>
<hr>
<p>The <a href="https://www.rdocumentation.org/packages/simEd/versions/2.0.0/topics/set.seed" target="_blank" rel="noopener noreferrer">set.seed()</a> function generates a sequence of random numbers, starting from the value you define in the brackets. This ensures you get the same sequence of random numbers each time you run set.seed() with the same value, which is helpful to test that your results are reproducible.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># random sampling</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sample</span>(LETTERS, <span class="dv">5</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"K"</span> <span class="st">"N"</span> <span class="st">"R"</span> <span class="st">"Z"</span> <span class="st">"G"</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sample</span>(LETTERS, <span class="dv">5</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"L"</span> <span class="st">"P"</span> <span class="st">"J"</span> <span class="st">"E"</span> <span class="st">"D"</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># reproducible random sampling</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">set.seed</span>(<span class="dv">42</span>); <span class="fu">sample</span>(LETTERS, <span class="dv">5</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Q"</span> <span class="st">"E"</span> <span class="st">"A"</span> <span class="st">"J"</span> <span class="st">"D"</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">set.seed</span>(<span class="dv">42</span>); <span class="fu">sample</span>(LETTERS, <span class="dv">5</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Q"</span> <span class="st">"E"</span> <span class="st">"A"</span> <span class="st">"J"</span> <span class="st">"D"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="automatic-logging" class="level3">
<h3 class="anchored" data-anchor-id="automatic-logging">Automatic logging</h3>
<hr>
<p>The <a href="https://cran.r-project.org/web/packages/tidylog/readme/README.html" target="_blank" rel="noopener noreferrer">tidylog package</a> is a really useful tool for providing automated feedback on dplyr and tidyr operations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidylog)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>filtered <span class="ot">&lt;-</span> <span class="fu">filter</span>(mtcars, cyl <span class="sc">==</span> <span class="dv">4</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; filter: removed 21 rows (66%), 11 rows remaining</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>mutated <span class="ot">&lt;-</span> <span class="fu">mutate</span>(mtcars, <span class="at">new_var =</span> wt <span class="sc">**</span> <span class="dv">2</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; mutate: new variable 'new_var' (double) with 29 unique values and 0% NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
</section>
<section id="troubleshooting" class="level2">
<h2 class="anchored" data-anchor-id="troubleshooting">Troubleshooting</h2>
<section id="cant-find-make-error" class="level3">
<h3 class="anchored" data-anchor-id="cant-find-make-error">Can’t find make error</h3>
<hr>
<p>This error will appear when trying to restore old package versions using <code>renv::restore()</code>. It is usually due to Rtools not being properly installed, and therefore your system is struggling to install the older version of the package that hasn’t been provided by CRAN.</p>
<p>The solution takes a few minutes, but is relatively straightforward, you can install Rtools as a direct download from the Software Centre. On there, pick the right version of RTools for your version of R and install the application.</p>
<p>Once it’s installed close and reopen RStudio and run <code>renv::restore()</code> again - it should hopefully now restore and install your packages successfully!</p>
<hr>
</section>
<section id="packages-not-downloading-due-to-wininet-error-renv-0.17" class="level3">
<h3 class="anchored" data-anchor-id="packages-not-downloading-due-to-wininet-error-renv-0.17">Packages not downloading due to “wininet” error (renv 0.17)</h3>
<hr>
<p>Packages are generally downloaded from CRAN using one of two methods: wininet or curl. Since renv version 0.17, analysts potentially hit an error associated with renv defaulting to wininet, whilst R defaults to curl, causing package downloads to fail. To fix this issue, analysts should change their default download method with renv to be curl. This can be done across all R-projects on your machine, by setting the default in your global R environment file (.Renviron). If you don’t know where to find your .Renviron file, then you can run the command <code>usethis::edit_r_environ()</code> (you may have to install the <code>usethis</code> package first) to open it in R-Studio. Once you’ve got it open, then add the following line to the .Renviron file:</p>
<p><code>RENV_DOWNLOAD_METHOD = "curl"</code></p>
<p>Then restart R-Studio and downloads with renv should now succeed.</p>
<hr>
</section>
<section id="ssl-certificate-errors" class="level3">
<h3 class="anchored" data-anchor-id="ssl-certificate-errors">SSL certificate errors</h3>
<hr>
<p>The DfE firewall currently blocks access to external sites from DfE laptops when connecting from common analytical software such as R or Python. This can prevent analysts from accessing important external resources such as package repositories and data API endpoints. If you get an error including text along the lines of “self signed SSL certificate not allowed” or anything similar involving SSL certificates (or certs.), then contact the <a href="mailto:statistics.development@education.gov.uk">Statistics Development Team</a> with a copy of the command that you’re running and the error that it’s producing. We can then work with the Network Operations team to prevent this being a blocker to your work.</p>
<hr>
</section>
<section id="shinytest2---invalid-path-to-chrome-chromote-error-message" class="level3">
<h3 class="anchored" data-anchor-id="shinytest2---invalid-path-to-chrome-chromote-error-message">shinytest2 - Invalid path to Chrome (chromote) error message</h3>
<hr>
<p>Sometimes when attempting to run tests using shinytest2, you will get the following error:</p>
<p><code>Error in initialize(...) : Invalid path to Chrome</code></p>
<p>Shinytest2 relies on Google Chrome to run, and so it needs to know where it has been installed on your computer. Chrome is not a standard piece of software for DfE laptops, so there are a few steps you can follow to resolve this issue.</p>
<p><strong>Before you try any of the steps below, please check that you have Google Chrome installed.</strong> You can download Chrome from <a href="https://www.google.com/intl/en_uk/chrome/" target="_blank">the Google Chrome website</a>. You may get an error message saying that you do not have adminstrator permissions when you run the install file. Click “No”, and you should be presented with another window that says “Google Chrome can be installed without administrator privileges. Continue?”. Click “Yes” on this screen and Chrome should install.</p>
<p>If you have Chrome installed and continue to get the chromote error when using shinytest2, then you’ll need to set an environment variable to tell R where to find Chrome.</p>
<p>The first step to resolve this is to set the path to chrome.exe (the Chrome application file itself where you’ve installed it) via the console for the current session. You can find the file path for your local Chrome installation by following these steps:</p>
<ul>
<li>Click the Start button</li>
<li>Right click on the Chrome icon and click ‘Open File Location’</li>
<li>When the folder opens, right click on Google Chrome inside the folder and click ‘Properties’</li>
<li>Copy the file path inside the Target box (see image below)</li>
</ul>
<p><img src="../images/find-chrome-location.png" class="img-fluid"></p>
<p>Set the <code>CHROMOTE_CHROME</code> environment variable to the path to the chrome.exe file on your computer. If you have followed the instructions above to copy the file path then you will need to make sure that you change the <code>\</code> to <code>/</code> before you run the code otherwise it will not work. As an example it should look something like this:</p>
<p><code>Sys.setenv(CHROMOTE_CHROME = "C:/Users/jbloggs/AppData/Local/Google/Chrome/Application/chrome.exe")</code></p>
<p>To set the environment variable, you’ll need to edit your .Renviron file. This will fix the error across all R projects. If you don’t know where to find the .Renviron file, you can use the <code>usethis</code> package to open it in R-Studio using <code>usethis::edit_r_environ()</code>. Then set the <code>CHROMOTE_CHROME</code> environment variable to the path to <code>chrome.exe</code> on your computer. As an example it should look something like this:</p>
<p><code>CHROMOTE_CHROME="C:/Users/jbloggs/AppData/Local/Google/Chrome/Application/chrome.exe"</code></p>
<p><strong>Note: remember to give the path using forward-slashes (/) rather than back-slashes (\).</strong></p>
<p>Once you’ve added that and saved the .Renviron file, restart your R session and that should then be loaded and shinytest2 will run. You can double check that it’s set the environment variable properly by running the following command:</p>
<p><code>Sys.getenv("CHROMOTE_CHROME")</code></p>
<p>That command should return the path that you entered for Chrome.</p>
<hr>
</section>
</section>
<section id="using-r-with-ada-databricks" class="level2">
<h2 class="anchored" data-anchor-id="using-r-with-ada-databricks">Using R with ADA / Databricks</h2>
<p>See our <a href="../ADA/databricks_rstudio_sql_warehouse.html">guidance on how to connect to Databricks SQL Warehouse from R Studio</a>, and <a href="../ADA/databricks_rstudio_personal_cluster.html">how to connect to Databricks personal cluster from R studio</a></p>
<p>You can also view example R code using the <a href="../ADA/ada.html#databricks-code-templates">Databricks code template notebooks</a></p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/dfe-analytical-services\.github\.io\/analysts-guide");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../learning-development/sql.html" class="pagination-link" aria-label="SQL">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">SQL</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../learning-development/git.html" class="pagination-link" aria-label="Git">
        <span class="nav-page-text">Git</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Department for Education, 2024</p>
</div>   
    <div class="nav-footer-center">

<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/dfe-analytical-services/analysts-guide/edit/main/learning-development/r.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/dfe-analytical-services/analysts-guide/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div><div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
<p>This page is maintained by statistics.development@education.gov.uk</p>
</div>
  </div>
</footer>




</body></html>